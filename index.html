<!DOCTYPE html>
<html>
    <head>
        <script src="/uber.js"></script>
        <title></title>
    </head>
    <body>
            <button onclick="loginWithUber()">Login with Uber</button>
        <script>
            let url = new URL(window.location.href);
            let code = url.searchParams.get("code");
            let token = localStorage.uberToken;
            //cancelCurrentRide();
            if(code){
                fetchToken(code, text => {
                    localStorage.uberToken = text.access_token;
                    window.location.href ="http://127.0.0.1";
                });
            }else{
                if(token){
                    getUserData(data =>{
                        console.log(data);
                    })
                    console.log("Have Token");
                    let sa = 36.141179;
                    let so = -86.796622;
                    let ea = 36.160201;
                    let eo = -86.779193;
                    getRideEstimate(sa, so, ea, eo, data => {
                        console.log(data);
                        console.log(data.fare.fare_id);
                        requestRide(data.fare.fare_id, sa, so, ea, eo, data => {
                            console.log(data);
                            cancelCurrentRide()
                        })
                    });
                    console.log("3")
                }
            }
        </script>
    </body>
</html>